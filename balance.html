<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>User Balance</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="assets/style.css">
</head>
<body>

<header class="header" role="banner" aria-label="Site header">
  <div class="brand">
    <img src="logo.png" class="logo" alt="logo">
    <div>
      <div class="site-name">Sarkar Telecom</div>
      <div class="muted small">Recharge & Topup</div>
    </div>
  </div>
  <div class="actions">
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Open menu" title="Menu">
      <svg width="18" height="14" viewBox="0 0 24 24" fill="none" aria-hidden><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
    </button>
    <div id="userInfo" class="kv"><span class="muted">Not signed in</span></div>
  </div>
</header>

<aside class="sidebar" id="rightSidebar" aria-hidden="true">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="font-weight:700">Navigation</div>
      <button class="btn btn-close">✕</button>
    </div>
    <nav class="nav">
      <a href="index.html" class="btn">🏠 Home</a>
      <a href="dashboard.html" class="btn">📊 Dashboard</a>
      <a href="order.html" class="btn">📱 New Order</a>
      <a href="order-history.html" class="btn">📃 Orders</a>
      <a href="profile.html" class="btn">👤 Profile</a>
      <a href="balance.html" class="btn">💰 Balance</a>
      <a href="admin.html" class="btn">⚙️ Admin</a>
    </nav>
  </div>
</aside>

<main class="main container">
  <div class="card">
<div class="card">
    <h2>💎 Your Balance</h2>
    <p><b>Current Balance:</b> <span id="balance">Loading...</span></p>
    <button class="btn logout" onclick="logoutUser()">Logout</button>
  </div>
  </div>
</main>


<footer class="site-footer" role="contentinfo">
  <div class="footer-nav">
    <a class="btn" href="index.html">🏠 Home</a>
    <a class="btn" href="order.html">📱 Order</a>
    <a class="btn" href="order-history.html">📃 Orders</a>
    <a class="btn" href="profile.html">👤 Profile</a>
  </div>
</footer>



<script src="header-loader.js" defer></script>
<script src="header-script.js" defer></script>


<main class="main container">
  <div class="card center">
    <img id="userPhoto" src="https://via.placeholder.com/100" alt="User" style="width:100px;height:100px;border-radius:50%;object-fit:cover;">
    <h2 id="userName">Loading...</h2>
    <p id="userEmail" class="muted small"></p>
    <div class="balance" style="margin-top:8px;font-weight:700">💎 Balance: <span id="userBalance">0</span></div>

    <div style="margin-top:18px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center">
      <button class="btn primary" onclick="location.href='order.html'">📱 New Order</button>
      <button class="btn" onclick="location.href='order-history.html'">📜 Order History</button>
      <button class="btn" onclick="location.href='profile.html'">👤 Profile</button>
      <button class="btn" onclick="location.href='balance.html'">💰 Balance</button>
    </div>
    <div style="margin-top:12px;font-size:13px;color:var(--muted)">This page uses your existing Firebase / Google integration unchanged.</div>
  </div>
</main>

<script>
// Ensure user is authenticated on page load. If not, redirect to login.html and return back after login.
(function(){
  function ensureAuth(){
    if(typeof auth !== 'undefined' && auth){
      // wait for onAuthStateChanged handled in header-script.js; also set a fallback timeout
      setTimeout(()=>{
        if(!window._authChecked){
          // try get currentUser
          const u = auth.currentUser;
          if(!u){
            const returnTo = encodeURIComponent(location.pathname);
            location.href = 'login.html?returnTo=' + returnTo;
          }
        }
      }, 1200);
    } else {
      // if auth not loaded, give small delay then redirect
      setTimeout(()=>{ const returnTo = encodeURIComponent(location.pathname); location.href = 'login.html?returnTo=' + returnTo; }, 800);
    }
  }
  ensureAuth();
})();
</script>
<script>
(function(){
  function setup(sidebarId, toggleId, closeSelector){
    const sidebar = document.getElementById(sidebarId);
    const toggle = document.getElementById(toggleId);
    if(!sidebar || !toggle) return;
    let closeBtn = sidebar.querySelector(closeSelector);
    if(!closeBtn){
      closeBtn = document.createElement('button');
      closeBtn.className = 'btn btn-close';
      closeBtn.innerText = '✕';
      closeBtn.style.marginLeft = 'auto';
      sidebar.insertBefore(closeBtn, sidebar.firstChild);
    }
    function setOpen(v){
      if(v){ sidebar.classList.add('open'); document.body.style.overflow='hidden'; }
      else { sidebar.classList.remove('open'); document.body.style.overflow=''; }
    }
    toggle.addEventListener('click', ()=> setOpen(true));
    closeBtn.addEventListener('click', ()=> setOpen(false));
    document.addEventListener('click', (e)=> { if(sidebar.classList.contains('open') && !sidebar.contains(e.target) && !toggle.contains(e.target)) setOpen(false)});
    document.addEventListener('keydown', (e)=> { if(e.key==='Escape') setOpen(false) });
  }
  setup('rightSidebar','sidebarToggle','.btn-close');
  setup('rightSidebar','sidebarToggleLogin','.btn-close');
})();
</script>

</body>
</html>