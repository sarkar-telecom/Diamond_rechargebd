<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Order History - Sarkar Telecom</title>
  <style>
    :root {
      --bg:#0f1115; --card:rgba(23,26,33,0.75);
      --text:#e7eaf0; --muted:#9aa3b2; --accent:#06b6d4;
      --ok:#22c55e; --bad:#ef4444; --wait:#facc15;
    }
    body { margin:0; font-family:Arial,sans-serif; background:var(--bg); color:var(--text); }
    header { background:var(--card); backdrop-filter:blur(10px);
             display:flex; justify-content:space-between; align-items:center;
             padding:12px 16px; border-bottom:1px solid #2b3347; }
    header h1 { margin:0; color:var(--accent); font-size:18px; display:flex; align-items:center; gap:6px; }
    .logout-btn { background:var(--bad); border:none; padding:6px 12px; border-radius:6px;
                  color:#fff; font-weight:bold; cursor:pointer; }

    .container { max-width:900px; margin:20px auto; padding:20px;
                 background:var(--card); border-radius:16px; backdrop-filter:blur(15px);
                 box-shadow:0 0 25px rgba(6,182,212,0.2); }
    h2 { color:var(--accent); margin-top:0; text-align:center; }

    .search-bar { display:flex; justify-content:center; gap:8px; margin-bottom:14px; }
    .search-bar input { flex:1; padding:8px; border-radius:6px; border:1px solid #2b3347;
                        background:#0f1115; color:var(--text); }
    .search-bar button { padding:8px 14px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; }
    .btn-search { background:var(--accent); color:#001; }
    .btn-clear { background:var(--bad); color:#fff; }
    .btn-new { background:var(--ok); color:#001; margin-bottom:12px; }

    table { width:100%; border-collapse:collapse; font-size:14px; }
    th, td { padding:10px; text-align:center; border-bottom:1px solid #2b3347; }
    th { background:rgba(6,182,212,0.2); color:var(--accent); }
    tr:hover { background:rgba(255,255,255,0.05); }

    .status { padding:4px 8px; border-radius:6px; font-weight:bold; font-size:13px; }
    .waiting { background:var(--wait); color:#000; }
    .complete { background:var(--ok); color:#fff; }
    .cancel { background:var(--bad); color:#fff; }

    .pagination { text-align:center; margin-top:12px; }
    .pagination button { margin:0 5px; padding:6px 12px; border:none;
                         border-radius:6px; cursor:pointer; font-weight:bold; }
    .pagination .active { background:var(--accent); color:#001; }
  </style>
</head>
<body>
  <header>
    <h1>üíé Order History</h1>
    <button id="logoutBtn" class="logout-btn">Logout</button>
  </header>

  <div class="container">
    <h2>üìú Your Orders</h2>

    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="üîç Search orders...">
      <button class="btn-search" onclick="searchOrders()">Search</button>
      <button class="btn-clear" onclick="clearSearch()">Clear</button>
    </div>

    <button class="btn-new" onclick="window.location.href='order.html'">‚ûï New Order</button>

    <table>
      <thead>
        <tr>
          <th>SL</th>
          <th>Number</th>
          <th>Amount</th>
          <th>Status</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody id="ordersTable">
        <tr><td colspan="5">‚è≥ Loading orders...</td></tr>
      </tbody>
    </table>

    <div class="pagination">
      <button onclick="prevPage()">‚¨Ö Prev</button>
      <span id="pageInfo"></span>
      <button onclick="nextPage()">Next ‚û°</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBIIOv-2Laqugv5_HAIRNJllp8YUfYndF8",
      authDomain: "diamond-recharge-f7f59.firebaseapp.com",
      projectId: "diamond-recharge-f7f59",
      storageBucket: "diamond-recharge-f7f59.appspot.com",
      messagingSenderId: "657717928489",
      appId: "1:657717928489:web:70431ebc9afb7002d4b238"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    document.getElementById("logoutBtn").onclick = () => signOut(auth);

    onAuthStateChanged(auth, user => {
      if (!user) {
        window.location.href = "login.html";
      }
    });

    // ‚úÖ Fake orders for demo (replace with Google Sheets fetch)
    let orders = [
      { number:"101010", amount:500, status:"Waiting", time:45911.2275 },
      { number:"101010", amount:100, status:"Waiting", time:45911.22727 },
      { number:"1000", amount:10, status:"Complete", time:45911.18878 },
      { number:"10000", amount:10000, status:"Cancel", time:45911.18776 }
    ];

    let currentPage = 1;
    const perPage = 6;

    function formatDate(excelDate) {
      const jsDate = new Date((excelDate - 25569) * 86400 * 1000);
      return jsDate.toLocaleString("en-GB", {
        day:"2-digit", month:"2-digit", year:"numeric",
        hour:"2-digit", minute:"2-digit", second:"2-digit",
        hour12:true
      });
    }

    function renderTable() {
      const table = document.getElementById("ordersTable");
      table.innerHTML = "";
      let start = (currentPage-1)*perPage;
      let end = start + perPage;
      let pageOrders = orders.slice(start, end);

      if(pageOrders.length === 0){
        table.innerHTML = `<tr><td colspan="5">No orders found.</td></tr>`;
        return;
      }

      pageOrders.forEach((o,i) => {
        table.innerHTML += `
          <tr>
            <td>${start+i+1}</td>
            <td>${o.number}</td>
            <td>${o.amount}</td>
            <td><span class="status ${o.status.toLowerCase()}">${o.status}</span></td>
            <td>${formatDate(o.time)}</td>
          </tr>
        `;
      });

      document.getElementById("pageInfo").textContent = `Page ${currentPage}`;
    }

    window.searchOrders = function(){
      const q = document.getElementById("searchInput").value.toLowerCase();
      orders = orders.filter(o => o.number.toLowerCase().includes(q));
      currentPage = 1;
      renderTable();
    }

    window.clearSearch = function(){
      window.location.reload();
    }

    window.prevPage = function(){
      if(currentPage>1){ currentPage--; renderTable(); }
    }
    window.nextPage = function(){
      if((currentPage*perPage)<orders.length){ currentPage++; renderTable(); }
    }

    renderTable();
  </script>
</body>
</html>